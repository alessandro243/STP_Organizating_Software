<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP - Processos de Atendimento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        /* Cores Tech/Modernas */
        :root {
            --color-primary: #0077B6; /* Azul Tech */
            --color-secondary: #00B4D8; /* Ciano Light */
            --color-bg-light: #E0F7FA; /* Muito Claro */
            --color-text-dark: #03045E; /* Azul Escuro (quase preto) */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC; /* Cor de fundo mais clara e suave */
            color: var(--color-text-dark);
        }
        
        .nav-tab {
            padding: 0.75rem 1.5rem; 
            border-radius: 0.75rem; 
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); 
        }
        
        .tab-active {
            background-color: var(--color-primary); 
            color: white;
            box-shadow: 0 6px 12px -2px rgba(0, 119, 182, 0.3); 
        }
        
        .tab-inactive {
            background-color: white; 
            color: var(--color-primary);
            border: 2px solid var(--color-secondary);
        }
        
        .tab-inactive:hover {
            background-color: var(--color-bg-light);
        }
        
        .content-pane {
            background-color: white;
            border-radius: 1rem; 
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08); 
            padding: 2rem 2.5rem; 
        }
        
        .form-section-title {
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--color-primary);
            border-bottom: 3px solid var(--color-secondary); 
            padding-bottom: 0.75rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
        }
        
        .form-section-title span {
            margin-right: 1rem;
            font-size: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600; 
            color: #475569;
            margin-bottom: 0.5rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid #CBD5E1;
            padding: 0.75rem 1rem; 
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #F8FAFC; 
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-secondary); 
            background-color: white;
        }

        /* Estilo para campos somente leitura (copiados) */
        .form-input[readonly] {
            background-color: var(--color-bg-light); 
            font-weight: 700;
            color: var(--color-text-dark);
        }
        
        .form-check-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #F8FAFC; 
            padding: 1rem 1.25rem;
            border-radius: 0.6rem;
            border-left: 5px solid var(--color-secondary); 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .form-check-label {
            font-weight: 600;
            color: var(--color-text-dark);
        }
        
        .form-check-description {
            font-size: 0.875rem;
            color: #64748B;
        }
        
        /* Bot√µes */
        .btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.6rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary, .print-button { 
            background-color: var(--color-primary);
            color: white;
        }
        
        .btn-primary:hover, .print-button:hover {
            background-color: #005A91; 
            box-shadow: 0 6px 10px -2px rgba(0, 119, 182, 0.4);
        }
        
        .btn-secondary {
            background-color: #E2E8F0;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background-color: #CBD5E1;
        }
        
        .btn-email {
            background-color: #FCD34D; 
            color: #854D0E;
        }
        
        .btn-email:hover {
            background-color: #FBBF24;
        }

        /* Cont√™iner de bot√µes de a√ß√£o */
        .action-buttons-container {
            display: flex;
            flex-direction: column; 
            gap: 1rem;
            margin-top: 1.5rem; 
            margin-bottom: 0.5rem;
        }
        
        @media (min-width: 640px) { 
            .action-buttons-container {
                flex-direction: row;
            }
        }


        /* --- Estilos de Impress√£o --- */
        @media print {
            body {
                background-color: #ffffff;
            }
            
            .action-buttons-container, header, nav { 
                 display: none !important;
            }

            .content-pane {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
            }
            
            .content-pane.hidden {
                display: none !important;
            }
            
            .content-pane:not(.hidden) {
                display: block !important;
            }

            .form-section-title {
                color: #000000;
                border-color: #999999;
                font-size: 1.5rem;
            }
            
            .form-check-item, .form-input, .form-textarea {
                page-break-inside: avoid;
            }

            @page {
                size: A4;
                margin: 2cm;
            }
        }
        /* --- Fim dos Estilos de Impress√£o --- */

    </style>
</head>
<body class="text-gray-900">

    <div class="container mx-auto p-4 md:p-6 lg:p-8 max-w-7xl">
        
        <header class="mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-[var(--color-primary)]">üíª STP - Painel de Processos</h1>
            <p class="text-xl text-gray-500 mt-2">Gest√£o de Chamados: Triagem, N√≠vel 1 e Escalonamento.</p>
        </header>

        <nav class="flex flex-wrap gap-3 md:gap-4 mb-8 print:hidden">
            <button id="tab-triagem" class="nav-tab tab-active">
                <span>üë§</span> Triagem (Atendente)
            </button>
            <button id="tab-n1" class="nav-tab tab-inactive">
                <span>‚öôÔ∏è</span> N√≠vel 1 (Campo)
            </button>
            <button id="tab-n2" class="nav-tab tab-inactive">
                <span>‚òÅÔ∏è</span> Escalonamento N2
            </button>
        </nav>

        <main>
            <section id="pane-triagem" class="content-pane">
                <form id="form-triagem">
                    <h2 class="form-section-title"><span>üìù</span> 1. Coleta de Dados e Agendamento</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4 mb-6">
                        <div class="md:col-span-2">
                            <label for="triagem_nome" class="form-label">Nome Completo do Cliente</label>
                            <input type="text" id="triagem_nome" class="form-input" placeholder="Ex: Jo√£o da Silva">
                        </div>
                        <div>
                            <label for="triagem_cpf" class="form-label">CPF/CNPJ (ID do Chamado)</label>
                            <input type="text" id="triagem_cpf" class="form-input" placeholder="Ex: 123.456.789-00" oninput="formatCpfCnpj(this)">
                        </div>
                        <div class="md:col-span-1">
                            <label for="triagem_contato" class="form-label">Telefone/WhatsApp</label>
                            <input type="tel" id="triagem_contato" class="form-input" placeholder="Ex: (21) 98287-9176">
                        </div>
                        <div class="md:col-span-2">
                            <label for="triagem_endereco" class="form-label">Endere√ßo Completo do Servi√ßo</label>
                            <input type="text" id="triagem_endereco" class="form-input" placeholder="Ex: Rua das Flores, 123, Niter√≥i">
                        </div>
                        <div class="md:col-span-3">
                            <label for="triagem_problema" class="form-label">Breve descri√ß√£o do problema (pelo cliente)</label>
                            <textarea id="triagem_problema" rows="3" class="form-textarea" placeholder="Ex: Minhas c√¢meras pararam de funcionar..."></textarea>
                        </div>
                    </div>

                    <h2 class="form-section-title"><span>üí°</span> 2. Triagem Remota (Solu√ß√£o R√°pida)</h2>
                    <p class="text-sm text-gray-500 mb-4 -mt-4">
                        Tente resolver problemas simples antes de deslocar o N1.
                    </p>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <div>
                                <p class="form-check-label">Energia</p>
                                <p class="form-check-description">A luz de "Power" (c√¢mera, DVR, roteador) est√° acesa?</p>
                            </div>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Sim</option>
                                <option>N√£o</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <div>
                                <p class="form-check-label">Reinicializa√ß√£o</p>
                                <p class="form-check-description">O cliente j√° tentou desligar e religar o equipamento?</p>
                            </div>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Sim</option>
                                <option>N√£o</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <div>
                                <p class="form-check-label">Rede (Roteador)</p>
                                <p class="form-check-description">O roteador est√° conectado e as luzes de internet est√£o OK?</p>
                            </div>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Sim</option>
                                <option>N√£o</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <div>
                                <p class="form-check-label">Acesso F√≠sico</p>
                                <p class="form-check-description">Algu√©m estar√° no local para receber o N1?</p>
                            </div>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Sim</option>
                                <option>N√£o</option>
                            </select>
                        </div>
                    </div>
                    
                    <h2 class="form-section-title"><span>üí∏</span> 3. Gest√£o de Expectativa (Pre√ßo vs. Realidade)</h2>
                    <p class="text-sm text-gray-500 mb-4 -mt-4">
                        Alinhe os custos com o cliente para evitar atritos.
                    </p>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <p class="form-check-label">Servi√ßo √© manuten√ß√£o/instala√ß√£o?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Pre√ßo final ser√° fechado ap√≥s avalia√ß√£o N1 *in loco*?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Pe√ßas e cabos necess√°rios ser√£o or√ßados √† parte?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Cliente concorda com o prazo de atendimento (ex: 24h/48h)?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                    </div>
                    
                    <h2 class="form-section-title"><span>üöÄ</span> A√ß√µes da Triagem</h2>
                    
                    <div class="action-buttons-container">
                        <button type="button" onclick="generatePdf('Triagem')" class="print-button btn font-bold w-full sm:w-auto">
                            <span>üñ®Ô∏è</span> 1. GERAR PDF
                        </button>
                        <button type="button" class="btn btn-secondary w-full sm:w-auto justify-center" onclick="finalizeService('Triagem')">
                            <span>‚úÖ</span> Resolvido Remotamente (Finalizar)
                        </button>
                    </div>
                    
                </form>
            </section>

            <section id="pane-n1" class="content-pane hidden">
                <form id="form-n1">
                    <h2 class="form-section-title"><span>üìù</span> 0. Contexto do Chamado (Da Triagem)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4 mb-6">
                        <div class="md:col-span-2">
                            <label class="form-label">Cliente</label>
                            <input type="text" id="n1_copy_nome" class="form-input" readonly>
                        </div>
                        <div>
                            <label class="form-label">ID/CPF (Refer√™ncia)</label>
                            <input type="text" id="n1_copy_cpf" class="form-input" readonly>
                        </div>
                    </div>
                    
                    <h2 class="form-section-title"><span>‚ö°</span> 1. Verifica√ß√µes Iniciais (Hardware e Energia)</h2>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <p class="form-check-label">Fonte de alimenta√ß√£o (DVR/C√¢meras/Roteador) testada?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Conex√£o do cabo de for√ßa firme e sem danos?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">LEDs de status normais (verde/azul)?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Nenhum sinal vis√≠vel de superaquecimento ou dano f√≠sico?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                    </div>

                    <h2 class="form-section-title"><span>üîå</span> 2. Camada F√≠sica e Cabeamento</h2>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <p class="form-check-label">Integridade do cabeamento (sem cortes/danos)?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Conectores (BNC/RJ45) testados e com crimpagem OK?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Ponto de rede OK para outros equipamentos (teste c/ laptop)?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Comprimento do cabo dentro do limite t√©cnico?</p>
                            <select class="form-select w-32">
                                <option>Pendente</option>
                                <option>Ok</option>
                                <option>Falha</option>
                            </select>
                        </div>
                    </div>

                    <h2 class="form-section-title"><span>üìä</span> 3. Documenta√ß√£o e Fechamento N1</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-6">
                        <div>
                            <label for="n1_diagnostico" class="form-label">Diagn√≥stico N1 (Problema f√≠sico e solu√ß√£o)</label>
                            <textarea id="n1_diagnostico" rows="3" class="form-textarea" placeholder="Ex: Cabo da c√¢mera 2 rompido. Feita a troca do conector."></textarea>
                        </div>
                        <div>
                            <label for="n1_popup" class="form-label">POP UP de Venda (Melhoria sugerida)</label>
                            <textarea id="n1_popup" rows="3" class="form-textarea" placeholder="Ex: Sugerida troca da fonte por uma de maior amperagem."></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label for="n1_tempo" class="form-label">Tempo Gasto (em minutos)</label>
                            <input type="number" id="n1_tempo" class="form-input" placeholder="Ex: 60">
                        </div>
                    </div>

                    <h2 class="form-section-title"><span>‚úÖ</span> A√ß√µes N1</h2>
                    
                    <div class="action-buttons-container">
                        <button type="button" class="btn btn-primary w-full sm:w-auto justify-center" onclick="finalizeService('N√≠vel 1')">
                            <span>‚úÖ</span> Servi√ßo Conclu√≠do (Falha F√≠sica Resolvida)
                        </button>
                        <button type="button" onclick="generatePdf('N√≠vel 1')" class="print-button btn font-bold w-full sm:w-auto">
                            <span>üñ®Ô∏è</span> GERAR PDF
                        </button>
                    </div>
                </form>
            </section>
            
            <section id="pane-n2" class="content-pane hidden">
                <form id="form-n2">
                    <h2 class="form-section-title"><span>üîó</span> 1. Dados B√°sicos do Chamado</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4 mb-6">
                        <div>
                            <label for="n2_id" class="form-label">ID do Chamado/Cliente (CPF/CNPJ)</label>
                            <input type="text" id="n2_id" class="form-input" placeholder="Refer√™ncia da Triagem" readonly>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Nome do Cliente</label>
                            <input type="text" id="n2_copy_nome" class="form-input" readonly>
                        </div>
                        <div>
                            <label for="n2_n1" class="form-label">T√©cnico N1 Respons√°vel</label>
                            <input type="text" id="n2_n1" class="form-input">
                        </div>
                        <div>
                            <label for="n2_data" class="form-label">Data/Hora da Passagem</label>
                            <input type="datetime-local" id="n2_data" class="form-input">
                        </div>
                    </div>
                    
                    <h2 class="form-section-title"><span>üõ°Ô∏è</span> 2. Status da Camada F√≠sica (Garantia do N1)</h2>
                    <p class="text-sm text-gray-500 mb-4 -mt-4">
                        O N2 s√≥ deve atuar se a camada f√≠sica estiver 100% OK.
                    </p>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <p class="form-check-label">Todos os equipamentos est√£o ligados e sem danos f√≠sicos?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Cabeamento e conectores (camada f√≠sica) testados e 100% OK?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">N1 confirmou que h√° sinal de internet/rede no local?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                    </div>
                    
                    <h2 class="form-section-title"><span>üíª</span> 3. Necessidade de Configura√ß√£o (Foco do N2)</h2>
                    <div class="space-y-4 mb-6">
                        <div class="form-check-item">
                            <p class="form-check-label">Cliente precisa de acesso via celular/computador?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Configura√ß√£o de IP/Portas do DVR/NVR necess√°ria?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="form-check-item">
                            <p class="form-check-label">Necessidade de integra√ß√£o com outros sistemas (ex: alarme)?</p>
                            <input type="checkbox" class="h-5 w-5 text-[var(--color-primary)] rounded">
                        </div>
                        <div class="mt-4">
                            <label for="n2_outros" class="form-label">Outra falha de software/l√≥gica (Detalhar)</label>
                            <textarea id="n2_outros" rows="2" class="form-textarea" placeholder="Ex: POP UP de vendas aparecendo no DVR..."></textarea>
                        </div>
                    </div>

                    <h2 class="form-section-title"><span>üîë</span> 4. Credenciais e Contato</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-6">
                        <div>
                            <label for="n2_roteador" class="form-label">Login/Senha do Roteador</label>
                            <input type="text" id="n2_roteador" class="form-input">
                        </div>
                        <div>
                            <label for="n2_dvr" class="form-label">Login/Senha do DVR/NVR</label>
                            <input type="text" id="n2_dvr" class="form-input">
                        </div>
                        <div>
                            <label for="n2_software" class="form-label">Software Usado (App)</label>
                            <input type="text" id="n2_software" class="form-input" placeholder="Ex: Hik-Connect, Intelbras Cloud">
                        </div>
                        <div>
                            <label for="n2_horario" class="form-label">Melhor Hor√°rio para Contato N2</label>
                            <input type="text" id="n2_horario" class="form-input" placeholder="Ex: Falar com Jo√£o ap√≥s 18h">
                        </div>
                    </div>

                    <div class="action-buttons-container">
                        <button type="button" class="btn btn-primary w-full sm:w-auto justify-center" onclick="finalizeService('N√≠vel 2')">
                            <span>‚úÖ</span> Servi√ßo Conclu√≠do (Falha L√≥gica Resolvida) 
                        </button>
                        <div class="w-full sm:w-auto"></div> 
                        <button type="button" onclick="generatePdf('N√≠vel 2')" class="print-button btn font-bold w-full sm:w-auto">
                            <span>üñ®Ô∏è</span> GERAR PDF
                        </button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <script>
        // Lista de e-mails do Suporte N1
        const N1_SUPPORT_EMAILS = [
            'igorlimeira@souunisuam.com.br',
            'alex.alessandro342@gmail.com',
            'igorlimeira7@gmail.com',
            'alex.alessandro6666@gmail.com'
        ];

        function formatCpfCnpj(field) {
            let value = field.value.replace(/\D/g, ''); 

            if (value.length <= 11) { // CPF
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else { // CNPJ
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
            }

            field.value = value;
        }

        function copyTriagemData() {
            const nome = document.getElementById('triagem_nome').value;
            const cpf = document.getElementById('triagem_cpf').value;

            // 1. Copia para o N√≠vel 1
            const n1Nome = document.getElementById('n1_copy_nome');
            const n1Cpf = document.getElementById('n1_copy_cpf');
            if (n1Nome) n1Nome.value = nome;
            if (n1Cpf) n1Cpf.value = cpf;

            // 2. Copia para o N√≠vel 2
            const n2Nome = document.getElementById('n2_copy_nome');
            const n2Cpf = document.getElementById('n2_id');
            if (n2Nome) n2Nome.value = nome;
            if (n2Cpf) n2Cpf.value = cpf;
        }
        
        function sendEmail(level) {
            // Garante que os dados da Triagem estejam prontos para N1/N2 se o usu√°rio n√£o tiver clicado no bot√£o
            if (level === 'N√≠vel 1' || level === 'N√≠vel 2') {
                copyTriagemData();
            }

            let subject = '';
            let body = '';
            let recipient = ''; 

            const cpf = document.getElementById('triagem_cpf').value || 'ID_PENDENTE';
            
            if (level === 'Triagem') {
                // A valida√ß√£o de CPF √© feita na fun√ß√£o generatePdf agora
                
                // Define o destinat√°rio para a lista de suporte N1
                recipient = N1_SUPPORT_EMAILS.join(',');
                subject = `STP-SUPORTE-N1 - CHAMADO ID ${cpf} - Encaminhamento para N1`;
                
                const nome = document.getElementById('triagem_nome').value;
                const contato = document.getElementById('triagem_contato').value;
                const endereco = document.getElementById('triagem_endereco').value;
                const problema = document.getElementById('triagem_problema').value;
                
                body = `[RELAT√ìRIO DE TRIAGEM ID: ${cpf}]\n\n`;
                body += `Prezado Suporte N1,\n\n`;
                body += `Este chamado foi triado e encaminhado para atendimento de campo (N√≠vel 1).\n\n`;
                body += `**ANEXAR PDF:** Por favor, verifique o arquivo PDF em anexo contendo o relat√≥rio completo da triagem e os dados do cliente.\n\n`;
                body += `Cliente: ${nome}\n`;
                body += `Contato: ${contato}\n`;
                body += `Endere√ßo: ${endereco}\n\n`;
                body += `Problema (Cliente): ${problema}\n\n`;
                body += `A√á√ÉO: Encaminhado para agendamento e atendimento N√≠vel 1 (Campo).`;

            } else if (level === 'N√≠vel 1') {
                // Para o relat√≥rio do N1, deixamos o 'to' vazio para o usu√°rio escolher o destinat√°rio 
                subject = `STP - CHAMADO ID ${cpf} - Diagn√≥stico N1`;
                const diagnostico = document.getElementById('n1_diagnostico').value;
                const popup = document.getElementById('n1_popup').value;
                const tempo = document.getElementById('n1_tempo').value;
                
                body = `[DIAGN√ìSTICO N√çVEL 1 - ID: ${cpf}]\n\n`;
                body += `Diagn√≥stico: ${diagnostico}\n`;
                body += `Tempo Gasto: ${tempo} minutos\n\n`;
                body += `POP UP de Venda (Sugest√£o de Melhoria):\n${popup}`;

            } else if (level === 'N√≠vel 2') {
                // Para o relat√≥rio do N2, deixamos o 'to' vazio para o usu√°rio escolher o destinat√°rio 
                subject = `STP - CHAMADO ID ${cpf} - Diagn√≥stico N2`;
                body = `[DIAGN√ìSTICO N√çVEL 2 - ID: ${cpf}]\n\n`;
                body += `O chamado foi conclu√≠do no N√≠vel 2 (Falha L√≥gica Resolvida).\n`;
                body += `Detalhes do Escalonamento N2 documentados no PDF anexado.`;
            }

            // Constr√≥i o link mailto
            const mailtoLink = `mailto:${encodeURIComponent(recipient)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // T√âCNICA PARA FOR√áAR A ABERTURA DO CLIENTE DE E-MAIL
            const tempLink = document.createElement('a');
            tempLink.href = mailtoLink;
            tempLink.style.display = 'none';
            document.body.appendChild(tempLink);
            tempLink.click();
            document.body.removeChild(tempLink);
            
            return true;
        }

        // NOVA FUN√á√ÉO SIMPLES: Apenas gera PDF
        function generatePdf(level) {
            
            // Valida√ß√£o de CPF/CNPJ para o n√≠vel Triagem (mantida como boa pr√°tica)
            if (level === 'Triagem') {
                const cpf = document.getElementById('triagem_cpf').value || 'ID_PENDENTE';
                if (!cpf || cpf === 'ID_PENDENTE' || cpf.replace(/\D/g, '').length < 11) {
                    alert('ERRO: Por favor, preencha o campo CPF/CNPJ (ID do Chamado) com um valor v√°lido antes de gerar o PDF.');
                    return; 
                }
            }
            
            // Apenas chama a fun√ß√£o de impress√£o/salvar PDF
            window.print();
        }

        function finalizeService(level) {
            let message = '';
            let formToClear = null;

            if (level === 'Triagem') {
                message = 'SUCESSO! Chamado resolvido remotamente. O formul√°rio de Triagem foi limpo para o pr√≥ximo atendimento.';
                formToClear = 'form-triagem';
            } else if (level === 'N√≠vel 1') {
                message = 'SUCESSO! Servi√ßo de campo (Falha F√≠sica) conclu√≠do e documentado.';
            } else if (level === 'N√≠vel 2') {
                message = 'SUCESSO! Escalonamento (Falha L√≥gica) conclu√≠do e documentado.';
            }

            alert(message);
            
            if (formToClear) {
                document.getElementById(formToClear).reset();
            }
        }

        window.onload = function () {
            const tabs = document.querySelectorAll('.nav-tab');
            const panes = document.querySelectorAll('.content-pane');
            
            const triagemPane = document.getElementById('pane-triagem');
            if (triagemPane) {
                triagemPane.classList.remove('hidden');
            }
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetPaneId = tab.id.replace('tab-', 'pane-');
                    
                    tabs.forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    
                    tab.classList.add('tab-active');
                    tab.classList.remove('tab-inactive');
                    
                    panes.forEach(pane => {
                        if (pane.id === targetPaneId) {
                            pane.classList.remove('hidden');
                        } else {
                            pane.classList.add('hidden');
                        }
                    });

                    // Chama a fun√ß√£o de c√≥pia de dados ao trocar de painel
                    if (targetPaneId !== 'pane-triagem') {
                        copyTriagemData();
                    }
                });
            });
        };
    </script>
</body>
</html>